{% extends 'dashboard.html' %}
{% block title %} Dashboard {% endblock %}
{% block dash_content %}
<!-- SCHOOL LIST MANAGEMENT -->
<div id="lists" class="container" style="padding-top:10px">
    <h1>My {{ cycle.cycle_year }} School List</h1>

    {% if cycle.schools|length > 0 %}
    <table class="table table-striped" style="font-size:0.9rem">
        <thead>
        <tr>
            <th>School</th>
            <th>Primary Submitted</th>
            <th>Secondary Received</th>
            <th>Application Complete</th>
            <th>Interview Received</th>
            <th>Interview Date</th>
            <th>Rejected</th>
            <th>Waitlisted</th>
            <th>Accepted</th>
            <th>Withdrawn</th>
            <th></th>
        </tr>
        </thead>
        {% for school in cycle.schools %}
        <!-- SETUP MODAL FOR EDITING -->
        <div class="modal fade" id="{{ school.name }}-modal" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <form method="POST">
                    <div class="modal-header">
                        <h5 class="modal-title">Edit {{ school.name }}</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                            <input type="hidden" id="cycle_id_modal" name="cycle_id" value="{{ cycle.id }}">
                            <input type="hidden" id="school_id" name="school_id" value="{{ school.id }}">
                            <input type="hidden" id="id" name="id" value="{{ school.id }}">
                            <div style="padding: 10px;">
                            <label for="primary">Primary Application Submitted/Verified Date</label>
                            <input type="date" class="form-control" id="primary" name="primary" value="{% if school.primary %}{{ school.primary.strftime('%Y-%m-%d') }}{% endif %}"/>
                            </div>
                            <div style="padding: 10px;">
                            <label for="primary">Secondary Received Date</label>
                            <input type="date" class="form-control" id="secondary_received" name="secondary_received" value="{% if school.secondary_received %}{{ school.secondary_received.strftime('%Y-%m-%d') }}{% endif %}" />
                            </div>
                            <div style="padding: 10px;">
                                <label for="primary">Application Complete Date</label>
                            <input type="date" class="form-control" id="application_complete" name="application_complete" value="{% if school.application_complete %}{{ school.application_complete.strftime('%Y-%m-%d') }}{% endif %}" />
                            </div>
                            <div style="padding: 10px;">
                                <label for="primary">Interview Received Date</label>
                            <input type="date" class="form-control" id="interview_received" name="interview_received" value="{% if school.interview_received %}{{ school.interview_received.strftime('%Y-%m-%d') }}{% endif %}" />
                            </div>
                            <div style="padding: 10px;">
                                <label for="primary">Interview Scheduled Date</label>
                            <input type="date" class="form-control" id="interview_date" name="interview_date" value="{% if school.interview_date %}{{ school.interview_date.strftime('%Y-%m-%d') }}{% endif %}" />
                            <small>If your interview is multiple days long, just enter the first day.</small>
                            </div>
                            <div style="padding: 10px;">
                                <label for="primary">Rejection Date</label>
                            <input type="date" class="form-control" id="rejection" name="rejection" value="{% if school.rejection %}{{ school.rejection.strftime('%Y-%m-%d') }}{% endif %}" />
                            </div>
                            <div style="padding: 10px;">
                                <label for="primary">Waitlist Date</label>
                            <input type="date" class="form-control" id="waitlist" name="waitlist" value="{% if school.waitlist %}{{ school.waitlist.strftime('%Y-%m-%d') }}{% endif %}" />
                            </div>
                            <div style="padding: 10px;">
                                <label for="primary">Acceptance Date</label>
                            <input type="date" class="form-control" id="acceptance" name="acceptance" value="{% if school.acceptance %}{{ school.acceptance.strftime('%Y-%m-%d') }}{% endif %}" />
                            </div>
                            <div style="padding: 10px;">
                                <label for="primary">Withdrawn Date</label>
                            <input type="date" class="form-control" id="withdrawn" name="withdrawn" value="{% if school.withdrawn %}{{ school.withdrawn.strftime('%Y-%m-%d') }}{% endif %}" />
                            </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                        <button type="button" class="btn btn-danger" onclick="deleteSchool({{ school.id }})">Delete School</button>
                    </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- DISPLAY SCHOOLS -->
        <tr class="{% if school.acceptance %}table-success{% elif school.waitlist %}table-warning{% elif school.rejection %}table-danger{% elif school.withdrawn %}table-secondary{% endif %}">
            <td>
                {{ school.name }}
            </td>
            <td>
                {% if school.primary %}
                {{ school.primary.strftime('%m/%d/%Y') }}
                {% endif %}
            </td>
            <td>
                {% if school.secondary_received %}
                {{ school.secondary_received.strftime('%m/%d/%Y') }}
                {% endif %}
            </td>
            <td>
                {% if school.application_complete %}
                {{ school.application_complete.strftime('%m/%d/%Y') }}
                {% endif %}
            </td>
            <td>
                {% if school.interview_received %}
                {{ school.interview_received.strftime('%m/%d/%Y') }}
                {% endif %}
            </td>
            <td>
                {% if school.interview_date %}
                {{ school.interview_date.strftime('%m/%d/%Y') }}
                {% endif %}
            </td>
            <td>
                {% if school.rejection %}
                {{ school.rejection.strftime('%m/%d/%Y') }}
                {% endif %}
            </td>
            <td>
                {% if school.waitlist %}
                {{ school.waitlist.strftime('%m/%d/%Y') }}
                {% endif %}
            </td>
            <td>
                {% if school.acceptance %}
                {{ school.acceptance.strftime('%m/%d/%Y') }}
                {% endif %}
            <td>
                {% if school.withdrawn %}
                {{ school.withdrawn.strftime('%m/%d/%Y') }}
                {% endif %}
            </td>
            <td>
                <button type="button" class="btn btn-link" data-toggle="modal" data-target="#{{ school.name }}-modal">
                    <i class="far fa-edit"></i>
                </button>
            </td>
        </tr>
        {% endfor %}
    </table>
    {% else %}
    <p>You have not added any schools.</p>
    {% endif %}
    <!-- Add Schools -->
    <form method="POST">
        <input type="hidden" name="cycle_id" id="cycle_id" value="{{ cycle.id }}">
        <table>
            <tr>
                <td style="padding: 10px">Add a new school:</td>
                <td style="padding: 10px">
                    <select name="add_school" id="add_school" class="btn-sm">
                        {% for school in school_list %}
                        <!-- Only allow entry in latest 3 cycles -->
                        <option value="{{ school }}">{{ school }}</option>
                        {% endfor %}
                    </select>
                </td>
                <td style="padding: 10px">
                    <button type="submit" class="btn btn-primary btn-sm">Submit</button>
                </td>
            </tr>
        </table>
    </form>
</div>
{% endblock %}